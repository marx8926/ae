{% extends "::base.html.twig" %}
  {% block stylesheets %}
        <link href="{{asset('css/bootstrap.css')}}" media="screen" rel="stylesheet" type="text/css">
        <link href="{{asset('css/style.css')}}" media="screen" rel="stylesheet" type="text/css">
        <link href="{{asset('css/bootstrap-responsive.css')}}" media="screen" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="{{asset('js/jquery-addresspicker/demos/themes/base/jquery.ui.all.css')}}">
        <link rel="stylesheet" href="{{asset('js/jquery-addresspicker/demos/demo.css')}}">           <!-- Scripts -->
 {% endblock %}

            
{% block content %}

   
    <div class="span9" id="registro_form">

        <h4>{{id}}</h4>
        
        <form class="form-horizontal"  method="POST" action="{{path('ganar_modificar_actualizar')}}" id="myForm">
            
            <fieldset>
                <legend>Usuario</legend>

                <div class="control-group">
                    <label class="control-label" >Usuario   </label>
                    <div class="controls">
                        <input type="text" id="inputUsuario" name="inputUsuario" placeholder="Usuario" class="input-xxlarge">
                    </div>
                </div>
        
                <div class="control-group">     
                    <label class="control-label" >Email</label>      
                    <div class="controls">
                        <input type="text" id="inputEmail" name="inputEmail" placeholder="Email" class="input-xxlarge">      
                    </div>      
                </div>
       
                <div class="control-group">     
                    <label class="control-label" >Contraseña Actual</label>      
                    <div class="controls">
                        <input type="password" id="inputPassword" name="inputPassword" placeholder="Contraseña" class="input-xxlarge">      
                    </div>
                </div>
          
                 <div class="control-group">     
                    <label class="control-label" >Nueva contraseña</label>      
                    <div class="controls">
                        <input type="password" id="inputPasswordN" name="inputPasswordN" placeholder="Contraseña" class="input-xxlarge">      
                    </div>
                </div>

            </fieldset>
                 
            <fieldset>
                <legend>Datos Personales</legend>

                <div class="control-group"> </div>
        
                <div class="control-group" >
                    <label class="control-label"> Nombres </label>
                    <div class="controls">
                         <input type="text" id="inputNombres" name="inputNombres" placeholder="Nombres" class="input-xxlarge" required="true"
                                >
                    </div>
                </div>
        
                <div class="control-group" >
                    <label class="control-label">Apellidos</label>
                    <div class="controls">
                         <input type="text" id="inputApellidos" name="inputApellidos" placeholder="Apellidos" class="input-xxlarge" 
                              >
                    </div>
                </div>
                
                <div class="control-group ">
                    <label class="control-label" for="select02"> Estado Civil</label>
                    <div class="controls">
                        <select id="select_Civil" name="select_Civil">
                            <option value="0">Solter@</option>
                            <option value="1">Casad@</option>                    
                        </select>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class= "control-label" for="select01"> Sexo </label>
                    <div  class="controls">
                        <select name="select_Sexo" id="select_Sexo" >
                            <option value="1">Masculino</option>
                            <option value="2">Femenino</option>
                        </select>
                    </div>
                </div>
        
                <div class="control-group">
                    <label class="control-label" >Fecha nacimiento</label>
                    <div class="controls">
                        <input type= "text" class="mask_date input-medium" id="inputFechaNacimiento" name="inputFechaNacimiento"/>
                        <p class="help-block">Año/Mes/Día</p>  
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label" >Edad</label>
                    <div class="controls">
                        <input type="text" class="input-large" placeholder="Edad" id="inputEdad" name="inputEdad"  pattern="[0-9]+"/>
                    </div>
                </div>
        
                <div class="control-group">
                    <label class="control-label" >Telefono</label>
                    <div class="controls">
                        <input type="text" class="input-large" placeholder="Telefono" id="inputTelefono" name="inputTelefono" pattern="[0-9]+"/>
                    </div>
                </div>
        
                <div class="control-group">
                    <label class="control-label" >Celular</label>
                    <div class="controls">
                        <input type="text" class="input-large" placeholder="Celular" id="inputCelular" name="inputCelular" pattern="[0-9]+"/>
                    </div>
                </div>

            </fieldset>
            
            <fieldset>
                <legend>Ubicación</legend>
        
                <div class="control-group">
                    <label class="control-label">Dirección</label>
                    <div class="controls">
                        <input type="text" class="input-xxlarge" id="inputDireccion" name="inputDireccion" >
                    </div>
                </div>
        
                <div class="control-group">
                    <label class="control-label">Referencia</label>
                    <div class="controls" >
                        <input type="text" class="input-xxlarge" id="inputReferencia" name="inputReferencia" >
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label" > Departamento</label>
                    <div class="controls">
                        <select name="departamento_lista" id="departamento_lista" >
                    
                        </select>
                    </div>
                </div>
        
                <div class="control-group">
                    <label class="control-label" >Provincia</label>
                    <div class="controls">
                        <select name="provincia_lista" id="provincia_lista">
                   
                        </select>
                    </div>
                </div>
        
                <div class="control-group">
                    <label class="control-label">Distrito</label>
                    <div class="controls">
                        <select name="distrito_lista" id="distrito_lista">
                    
                        </select>
                    </div>        
                </div>
        

         <div class="control-group">
            
            <label>Ubicación</label>
                   <div class='input'>
                       <div style="display: none;"><label>Dirección: </label> <input id="addresspicker_map" name="addresspicker_map" disabled="disabled"/></div>   <br/>
		
                       <label>Latitud:      </label> <input id="lat" name="latitud" value="-8.116752"> <br/>
                       <label>Longitud:      </label> <input id="lng" name="longitud" value="-79.019616"> <br/>
                    </div>
            <div id="map"></div>
   
        </div>
        
    </fieldset>
    <fieldset>
        <legend>Iglesia</legend>
        <div class="control-group">
            <label class="control-label" >Red</label>
            <div class="controls">
                <select id="red_lista" name="red_lista">
                   
                </select>
            </div>
        </div>
       
        <div class="control-group">
            <label class="control-label">Célula</label>
            <div class="controls">
                <select id="celula_lista" name="celula_lista">
                   
                </select>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">Fecha</label>
            <div class="controls">
                <input type= "text" class="mask_date input-medium" id="inputFechaConversion" name="inputFechaConversion"/>
                <p class="help-block">Año/Mes/Día</p>  
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">Lugar</label>
            <div class="controls">
                <select id="lugar" name="lugar">
                   
                </select>
            </div>
        </div>
    </fieldset>
            
    <fieldset>
        
        <legend>Redes Sociales</legend>        
        
        <div class="control-group">
            <label class="control-label">Facebook</label>
            <div class="controls">
                <input type="text" class="input-xxlarge" id="inputFacebook" name="inputFacebook">
                
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">Twitter</label>
            <div class="controls">
                <input type="text" class="input-xxlarge" id="inputTwitter" name="inputTwitter">
                
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">Webpage</label>
            <div class="controls">
                <input type="text" class="input-xxlarge" id="inputWebpage" name="inputWebpage">
                
            </div>
        </div>
            
    </fieldset>
            
            <fieldset>
                <legend>Descripción</legend>
                
                <div class="control-group">
                    <label class="control-label">Descripción</label>
                    <div class="controls">
                        <textarea rows="5" id="inputDescripcion" name="inputDescripcion" class="input-xxlarge" > </textarea>
                    <p class="help-block">Pedido de oración u otro detalle</p>
                    </div>
                </div>          
            
            </fieldset>
         
              
              <div class="control-group">
                  <label></label>
                  <div class="controls">
                      <input class="btn btn-small btn-primary" type="submit" id="login" name="login" value="Registrar" />
                  </div>
              </div>
              
        </form>
        

</div>

{% endblock %}
                
      {%block javascript %}
           
                <script src="{{asset('js/jquery.js')}}"></script>
				<script src="{{asset('js/less.js')}}"></script>
				<script src="{{asset('js/bootstrap.js')}}"></script>
				<script src="{{asset('js/bootstrap.min.js')}}"></script>
				<script src="{{asset('js/jquery.peity.js')}}"></script>
				<script src="{{asset('js/jquery.fancybox.js')}}"></script>
				<script src="{{asset('js/jquery.flot.js')}}"></script>
				<script src="{{asset('js/jquery.color.js')}}"></script>
				<script src="{{asset('js/jquery.flot.resize.js')}}"></script>
				<script src="{{asset('js/custom.js')}}"></script>            
			    <script src="https://maps.google.com/maps/api/js?sensor=false"></script>
			    <script src="{{asset('js/jquery-addresspicker/lib/jquery-ui-1.8.7.min.js')}}" > </script>
			    <script src="{{asset('js/jquery-addresspicker/src/jquery.ui.addresspicker.js')}}"> </script>     
			    <script src="{{asset('js/bootstrap.datepicker.js')}}"></script>
			  	<script src="{{asset('js/jquery.inputmask.min.js')}}"></script>
  	
            <script type="text/javascript">
                 
                    var ubiqeo = 0;
                 
                     $(document).ready(function(){
                         
                      //recuperar los datos
                        var codigo = {{id}};
                

                        //lista de redes
                     $.ajax(
                        {url : '{{path('servicio_red')}}',
                         dataType:"json",
                        type: "POST",
                        async: false,
                        }
                      ).done(redes);
           
            
                       //lista de departamentos
                        $.ajax(
                        {url : '{{path('servicio_region')}}',
                         dataType:"json",
                        type: "POST",
                        async: false,
                        }
                        ).done(departamentos);
                 
    
                        //lista de lugares
                        $.getJSON('{{path('servicio_lugar')}}',lug);
                 

                        //cambio de departamento
                        $("#departamento_lista").change(recarga_provincias);
                  
                        //cambio de provincia
                        $("#provincia_lista").change(recarga_distritos);
              
                   
                        $("#red_lista").change(recargar_celula);
                        
                          
                       
                        //carga datos de usuario
                                   
                        var url = '{{path('servicio_usuario_id',{'id':'cod'}) }}';
                        var ruta = url.replace('cod',codigo);
                        $.ajax(
                            {   url : ruta,
                                dataType:"json",
                                type: "POST",
                                async: false,
                            }
                        ).done(user);
    
             
                        
                        //nombres
                 
                        url = '{{path( 'servicio_persona_id', {'id':'cod'} )}}';
                        ruta = url.replace('cod',codigo);
                        $.ajax(
                            {   url : ruta,
                                dataType:"json",
                                type: "POST",
                                async: false,
                            }
                        ).done(nombres);
                 
                        //nuevo convertido
                        url = '{{path( 'servicio_nuevo_convertido_id', {'id':'cod'} )}}';
                        ruta = url.replace('cod',codigo);
                        $.ajax(
                            {   url : ruta,
                                dataType:"json",
                                type: "POST",
                                async: false,
                            }
                        ).done(convertido);
                            
    
                        //red social
                        url = '{{path( 'servicio_red_social', {'id':'cod'} )}}';
                        ruta = url.replace('cod',codigo);
                        $.ajax(
                            {   url : ruta,
                                dataType:"json",
                                type: "POST",
                                async: false,
                            }
                        ).done(sociales);
    
                        var x =$("login");
                        x.click();
    
                         $("#myForm").submit(function(){
                             console.log($("#myForm").serialize());
                             
                            //get the url for the form
                        var url=$("#myForm").attr("action");
                     
                        //start send the post request
                        $.post(url,{
                            formName:$("#myForm").serialize(),
                            ubi: ubigeo,
                            id : {{id}},
                            other:"attributes"
                        },function(data){
                        //the response is in the data variable
               
                        if(data.responseCode==200 ){           
                      
                            alert('Registro Completado');
                            var href="{{path('main')}}";
             
                            $(location).attr('href',href); 
                        }
                        else if(data.responseCode==400){//bad request
                            alert('Error bad request');
                        }
                        else{                        
                            if(data.responseCode==500)
                            {
                                alert('Error bad request');
                            }
                            else alert("An unexpeded error occured.");
                            }
                        }
                    );
                    return false;});
                    
                    $(function() {
                    var addresspickerMap = $( "#addresspicker_map" ).addresspicker({
                        elements: {
                        map:      "#map",
                        lat:      "#lat",
                        lng:      "#lng"
                        }
                    });
                    var gmarker = addresspickerMap.addresspicker( "marker");
                    gmarker.setVisible(true);
                    addresspickerMap.addresspicker( "updatePosition");
		
                    });
            
  
            });
            

            //recuperar los datos
             function user(dato)
             {
                  if(dato!=false)
                  {
                      $("#inputUsuario").val(dato.nombre);  
                  }
             }

             function nombres(dato)
             {

                 if(dato!=false)
                 { 
                     $('#inputNombres').val(dato.nombre); $('#inputNombres').text(dato.nombre);
                     $('#inputApellidos').val(dato.apellidos); $('#inputApellidos').text(dato.apellidos);
                     
                     //estado civil
                     if(dato.estado_civil ==0)
                        $("#select_Civil").val('0'); 
                     else $('#select_Civil').val('1');
                     
                     //sexo
                     if(dato.sexo==1)
                        $('#select_Sexo').val('1');
                    else
                        $('#select_Sexo').val('2');
                    
                     //email
                     $('#inputEmail').val(dato.email);
                     
                     //edad
                     $('#inputEdad').val(dato.edad);
                     
                     //Fecha nacimiento
                      $('#inputFechaNacimiento').val(dato.fecha_nacimiento);
                      
                      //telefono
                      $('#inputTelefono').val(dato.telefono);
                      
                      //celular
                      $('#inputCelular').val(dato.celular);
                     
                      //webpage
                      $('#inputWebpage').val(dato.website);
                      
                      //direccion
                      $('#inputDireccion').val(dato.direccion);
                      
                      //referencia
                      $('#inputReferencia').val(dato.referencia);
                      
                      $('#lat').val(dato.latitud);
                      $('#lng').val(dato.longitud);
                      
                      //departamento, provincia y distrito
                      var url = '{{path('servicio_ubigeo',{'id':'cod'}) }}';
                       var ruta = url.replace('cod',dato.id_ubigeo);
                       
                      ubigeo = dato.id_ubicacion;

                      $.ajax(
                            {   url : ruta,
                                dataType:"json",
                                type: "POST",
                                async: false,
                            }
                        ).done(ubicacion);
                      
                      //mapa
                    //  mapa(dato.longitud, dato.latitud);
                 }
             }
             function convertido(dato)
             {
                 if(dato!=false)
                 {
                     $('#red_lista').val(dato.id_red);
                     recargar_celula();
                     
                     $('#celula_lista').val(dato.id_celula);
                     
                     $('#inputFechaConversion').val(dato.fecha_conversion);
                     //peticion 
                    $('#inputDescripcion').val(dato.peticion);
                    
                    var url = '{{path('servicio_lugar_id',{'id':'cod'}) }}';
                    var ruta = url.replace('cod',dato.id_lugar);
                    
                       
                    $.ajax(
                            {   url : ruta,
                                dataType:"json",
                                type: "GET",
                                async: false,
                            }
                        ).done(lugar);
                                             
                 }
             }
             function lugar(dato)
             {
                $('#lugar').val(dato[0].id);
             }
             function ubicacion(dato)
             {
                 if(dato!=false)
                 {
                    //lista de departamentos

                   $('#departamento_lista').val(dato[0].coddepartamento);
                   
                   recarga_provincias();

                   $('#provincia_lista').val(dato[0].codprovincia);
                   
                  recarga_distritos();

                   $('#distrito_lista').val(dato[0].id);
                 }
                 
             }
             
             function sociales(dato)
             {
                for(var i=0;i<dato.length; i++)
                {
                    if(dato[0].tipo=='facebook'){
                        $('#inputFacebook').val(dato[i].enlace);
                    }
                    else if(dato[0].tipo=='twitter')
                    {
                        $('#inputTwitter').val(datos[i].enlace);
                    }
                }
             }
    
            //lugares
            function lug(dato)
            {
             
                $('#lugar').empty();
                for(var i=0; i<dato.length; i++)
                {
                      
                    $('<option value='+dato[i].id+'>'+dato[i].nombre+'</option>').appendTo('#lugar');

                }
                 
            }
            function redes(dato)
            {        
                $('#red_lista').empty();
                     
                $("<option value='-1'>Sin red </option>").appendTo('#red_lista');
                
                for(var i=0;i<dato.length;i++)
                {
               
                    
                    $('<option value='+dato[i].id+'>'+dato[i].id+'</option>').appendTo('#red_lista');
                }    
          
                recargar_celula();
            }
            
            function recargar_celula()
            {
                var nombre = $("#red_lista option:selected").val();  
            
                 var route = '{{path('servicio_celula',{'id': 'name'})}}';
            
                 var rutas = route.replace('name',nombre);
         
            
                 $.ajax(
                        {url : rutas,
                         dataType:"json",
                        type: "POST",
                        async: false,
                        }
                        ).done(celula);           
     
            }
            function celula(dato)
            {
                $('#celula_lista').empty();
                for(var i=0;i<dato.length; i++)
                {   
                    $('<option value='+dato[i].id+'>'+dato[i].id+'</option>').appendTo('#celula_lista');
                }
        
            }
         
            function departamentos(datos)
            {
                for(var i=0; i<datos.length ; i++)
                {
                    $('<option value='+datos[i].coddepartamento+'>'+datos[i].departamento+'</option>').appendTo('#departamento_lista');
                } 
                    
               recarga_provincias();
            }
    
            function recarga_provincias()
            {
                var id = $("#departamento_lista option:selected").val();              
                var route = '{{path('servicio_provincia',{'id': 'nom'})}}';            
                var rutas = route.replace('nom',id);         
            
                $.ajax(
                        {   url : rutas,
                            dataType:"json",
                            type: "POST",
                            async: false,
                        }
                    ).done(provincias);
            }
            
            function provincias(dato)
            {
                $("#provincia_lista").empty();
                for(var i=0;i<dato.length;i++)
                {
                    $('<option value='+dato[i].codprovincia+'>'+dato[i].provincia+'</option>').appendTo('#provincia_lista');
                } 
                recarga_distritos();
            }
                
            function recarga_distritos()
            {
                var dep=$("#departamento_lista option:selected").val();
                var prov = $("#provincia_lista option:selected").val();
   
                var route = '{{path('servicio_distrito',{'dep':'id1','prov':'id2'})}}';
                    
                var rutas = route.replace('id1', dep);                    
                rutas = rutas.replace('id2', prov);
                    
                 $.ajax(
                        {   url : rutas,
                            dataType:"json",
                            type: "POST",
                            async: false,
                        }
                    ).done(distrito);
            }
            
            function distrito(dato)
            {
                   
                $("#distrito_lista").empty();
                for(var i=0;i<dato.length;i++)
                {
                    $('<option value='+dato[i].id+'>'+dato[i].distrito+'</option>').appendTo('#distrito_lista');
                }
           }
            
            </script>
        
      {% endblock %} 